<?xml version="1.0" encoding="UTF-8"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:pr="http://primefaces.org/ui"
    contentType="text/html">
	
	<ui:composition template="../public/template/template.xhtml">
    
		<ui:define name="body">
					
			<div class="row" style="margin-top: 50px;">
			
				<div class="modal fade" id="modalDetalheExclusao" tabindex="-1" role="dialog" aria-labelledby="myModalExclusaoLabel">
			    	<div class="modal-dialog">
				        <div class="modal-content">
				        	<h:panelGroup id="panelModalDetalheExclusao">
					        	<div class="modal-header">
						            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
						            <h4 class="modal-title">Exclusão</h4>
					          	</div>
				          		<div class="modal-body">
				          			<div class="row">
				          				<div class="col-md-12">
				          					Deseja realmente excluir a notificação?
				          				</div>
				          			</div>
				          		</div>
				          	</h:panelGroup>
				          	
				          	<div class="modal-footer">
			            		<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Fechar</button>
			            		
			            		<pr:commandLink 
			            			styleClass="btn btn-sm btn-primary" 
			            			value="Excluir"
			            			process="@this"
			            			update="mensagens notificacaoTable"
			            			oncomplete="fecharModalExclusao()" 
			            			action="#{notificacaoView.excluirNotificacao()}" />
			          		</div>
				          	
				          </div>
			    	</div>
			    </div>
			
				<div class="modal fade" id="modalNova" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			    	<div class="modal-dialog" style="width: 90%;">
				        <div class="modal-content">
				        	<h:panelGroup id="panelModalNova">
					        	<div class="modal-header">
						            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
						            <h4 class="modal-title">Nova Notificação</h4>
					          	</div>
				          		<div class="modal-body">
				          			<div class="row">
				          				<div class="col-md-12" style="margin-top: 10px">
				          					<label>Público*:</label>
				          					<h:selectOneMenu 
												id="statusPesquisa"
				        						styleClass="form-control"
				        						value="#{notificacaoView.publico}" 
												label="Público"
												rendered="#{empty notificacaoView.usuarioTele or empty notificacaoView.usuarioTele.indicadorTeleTaxi or notificacaoView.usuarioTele.indicadorTeleTaxi ne 1}"
												style="height: 42px;">
												<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
												<f:selectItem itemLabel="Para todos os Motoristas" itemValue="1" />
												<f:selectItem itemLabel="Para todos os Lojistas" itemValue="2" />
												<f:selectItem itemLabel="Para todos os Usuários (Exceto Motoristas e Lojistas)" itemValue="3" />
												<f:selectItem itemLabel="Para todos os Usuários em Geral" itemValue="4" />
												<f:selectItem itemLabel="Para um Motorista Específico" itemValue="5" />
												<f:selectItem itemLabel="Para um Lojista Específico" itemValue="6" />
												<f:selectItem itemLabel="Para um Usuário (Exceto Motoristas e Lojistas) Específico" itemValue="7" />
												<f:selectItem itemLabel="Para todos os Motoristas Tele-Táxi" itemValue="8" />
												<f:selectItem itemLabel="Para todos os Motoristas Ligue-Táxi" itemValue="9" />
												<f:selectItem itemLabel="Para um Motorista Tele-Táxi Específico" itemValue="10" />
												<f:selectItem itemLabel="Para um Motorista Ligue-Táxi Específico" itemValue="11" />
												<pr:ajax oncomplete="esconderLoading()" event="change" listener="#{notificacaoView.carregarInformacoesTipoNotificacao}" update="formPrincipal:cidadeNotificacao formPrincipal:usuariosNotificacao" />
											</h:selectOneMenu>
											<h:selectOneMenu 
												id="statusPesquisa1"
				        						styleClass="form-control"
				        						value="#{notificacaoView.publico}" 
												label="Público"
												rendered="#{not empty notificacaoView.usuarioTele and not empty notificacaoView.usuarioTele.indicadorTeleTaxi and notificacaoView.usuarioTele.indicadorTeleTaxi eq 1 and notificacaoView.usuarioTele.tipoTeleTaxi eq 1}"
												style="height: 42px;">
												<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
												<f:selectItem itemLabel="Para todos os Motoristas Ligue-Táxi" itemValue="9" />
												<!-- <f:selectItem itemLabel="Para um Motorista Ligue-Táxi Específico" itemValue="11" /> -->
												<pr:ajax oncomplete="esconderLoading()" event="change" listener="#{notificacaoView.carregarInformacoesTipoNotificacao}" update="formPrincipal:cidadeNotificacao formPrincipal:usuariosNotificacao" />
											</h:selectOneMenu>
											<h:selectOneMenu 
												id="statusPesquisa2"
				        						styleClass="form-control"
				        						value="#{notificacaoView.publico}" 
												label="Público"
												rendered="#{not empty notificacaoView.usuarioTele and not empty notificacaoView.usuarioTele.indicadorTeleTaxi and notificacaoView.usuarioTele.indicadorTeleTaxi eq 1 and notificacaoView.usuarioTele.tipoTeleTaxi eq 2}"
												style="height: 42px;">
												<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
												<f:selectItem itemLabel="Para todos os Motoristas Tele-Táxi" itemValue="8" />
												<!-- <f:selectItem itemLabel="Para um Motorista Tele-Táxi Específico" itemValue="10" /> -->
												<pr:ajax oncomplete="esconderLoading()" event="change" listener="#{notificacaoView.carregarInformacoesTipoNotificacao}" update="formPrincipal:cidadeNotificacao formPrincipal:usuariosNotificacao" />
											</h:selectOneMenu>
											<h:selectOneMenu 
												id="statusPesquisa3"
				        						styleClass="form-control"
				        						value="#{notificacaoView.publico}" 
												label="Público"
												rendered="#{not empty notificacaoView.usuarioTele and not empty notificacaoView.usuarioTele.indicadorTeleTaxi and notificacaoView.usuarioTele.indicadorTeleTaxi eq 1 and notificacaoView.usuarioTele.tipoTeleTaxi eq 3}"
												style="height: 42px;">
												<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
												<f:selectItem itemLabel="Para todos os Motoristas Tele-Táxi" itemValue="8" />
												<f:selectItem itemLabel="Para todos os Motoristas Ligue-Táxi" itemValue="9" />
												<!-- <f:selectItem itemLabel="Para um Motorista Tele-Táxi Específico" itemValue="10" />
												<f:selectItem itemLabel="Para um Motorista Ligue-Táxi Específico" itemValue="11" />  -->
												<pr:ajax oncomplete="esconderLoading()" event="change" listener="#{notificacaoView.carregarInformacoesTipoNotificacao}" update="formPrincipal:cidadeNotificacao formPrincipal:usuariosNotificacao" />
											</h:selectOneMenu>
				          				</div>
				          				<t:div id="cidadeNotificacao">
					          				<t:div styleClass="col-md-12" style="margin-top: 10px" rendered="#{notificacaoView.publico eq 5 or notificacaoView.publico eq 6 or notificacaoView.publico eq 7 or notificacaoView.publico eq 10 or notificacaoView.publico eq 11}">
					          					<label>Cidade*:</label>
					          					<h:selectOneMenu 
													id="cidadeUsuarios"
					        						styleClass="form-control"
					        						value="#{notificacaoView.cidade}" 
													label="Cidade"
													converter="indexConverter"
													style="height: 42px;">
													<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
													<t:selectItems value="#{notificacaoView.cidades}" 
															   var="cidade"
															   itemLabel="#{cidade.nome}"
															   itemValue="#{cidade}" />
													<pr:ajax oncomplete="esconderLoading()" event="change" listener="#{notificacaoView.carregarUsuariosPorCidade}" update="formPrincipal:usuariosNotificacao" />
												</h:selectOneMenu>
					          				</t:div>
					          			</t:div>
					          			<t:div id="usuariosNotificacao">
					          				<t:div styleClass="col-md-12" style="margin-top: 10px" rendered="#{(notificacaoView.publico eq 5 or notificacaoView.publico eq 6 or notificacaoView.publico eq 7 or notificacaoView.publico eq 10 or notificacaoView.publico eq 11) and not empty notificacaoView.cidade}">
					          					<label>Usuário*:</label>
					          					<h:selectOneMenu 
													id="usuariosCidade"
					        						styleClass="form-control"
					        						value="#{notificacaoView.usuario}" 
													label="Usuário"
													converter="indexConverter"
													style="height: 42px;">
													<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
													<t:selectItems value="#{notificacaoView.usuarios}" 
															   var="usuario"
															   itemLabel="#{usuario.nome}"
															   itemValue="#{usuario}" />
												</h:selectOneMenu>
					          				</t:div>
					          			</t:div>
					              		<div class="col-md-12" style="margin-top: 10px">
						        			<label>Texto*:</label>
						        			<h:inputTextarea styleClass="form-control" required="true" label="Texto" value="#{notificacaoView.notificacao.texto}">
						        				<f:passThroughAttribute name="placeholder" value="Texto" />
						        			</h:inputTextarea>
										</div>
				          			</div>
						  		</div>
						  	</h:panelGroup>
			         
			          		<div class="modal-footer">
			            		<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Fechar</button>
			            		
			            		<h:commandLink 
			            			styleClass="btn btn-sm btn-primary" 
			            			value="Salvar" 
			            			action="#{notificacaoView.salvarNotificacao()}" />
			          		</div>
				   		</div>
					</div>
		   		</div>
			
				<div class="col-sm-12 col-xs-12">
		      		<div class="card">
		        		<div class="card-header">
		        			Pesquisa
		        		</div>
		        		<div class="card-body">
		          			<div class="section">
		            			<div class="section-body">
		            			
		            				<t:div id="mensagens">
					     				<t:div styleClass="row" rendered="#{notificacaoView.messages}" style="padding-left: 10px; padding-right: 10px;">
											<t:div rendered="#{notificacaoView.mensagensErro}" class="alert alert-danger">
												<h3><i class="fa fa-times"></i> Erro!</h3>
												<h:messages style="list-style-type: none !important;" />
						                    </t:div>
						                    
						                    <t:div rendered="#{!notificacaoView.mensagensErro}" class="alert alert-success">
												<h3><i class="fa fa-check"></i> Sucesso!</h3>
												<h:messages style="list-style-type: none !important;" />
						                    </t:div>
										</t:div>
									</t:div>
									        
						        	<div class="row">
						        		<div class="col-md-6" style="padding-bottom: 10px;">
						        			<h3>Filtro de Pesquisa</h3>
						        		</div>
						        		<div class="col-md-6" style="text-align: right;">
						        			<pr:commandLink 
						        				update="panelModalNova"
												process="@this" 
												styleClass="btn btn-primary" 
												onclick="exibirNova()">
						        				<i class="fa fa-plus"></i> Nova Notificação
						        				<f:setPropertyActionListener value="#{null}" target="#{notificacaoView.notificacao}"></f:setPropertyActionListener>
						        				<f:setPropertyActionListener value="#{null}" target="#{notificacaoView.publico}"></f:setPropertyActionListener>
						        				<f:setPropertyActionListener value="#{null}" target="#{notificacaoView.usuario}"></f:setPropertyActionListener>
						        				<f:setPropertyActionListener value="#{null}" target="#{notificacaoView.cidade}"></f:setPropertyActionListener>
						        			</pr:commandLink>
						        		</div>
						        		<br />
							        	<div class="col-md-12" style="clear: both; margin-top: 10px">
						        			<label>Texto:</label>
											<h:inputText 
						        				id="textoPesquisa"
						        				styleClass="form-control" 
						        				label="Nome" 
						        				value="#{notificacaoView.filtro.texto}">
						        				<f:passThroughAttribute name="placeholder" value="Nome" />
						        			</h:inputText>
										</div>
										<div class="col-md-12" style="text-align: right; margin-top: 10px;">
				        					<h:commandLink 
				        						styleClass="btn btn-warning" 
				        						immediate="true" 
				        						action="#{menuView.carregarMenu(1, 'inicio')}" 
				        						value="Voltar" 
				        						style="margin-right: 10px;" />
				        					
				        					<pr:commandLink 
				        						styleClass="btn btn-default" 
				        						style="margin-right: 10px;" 
				        						value="Limpar"
				        						update="textoPesquisa notificacaoTable mensagens"
						        				action="#{notificacaoView.limparFormulario()}"
						        				process="@this"
						        				immediate="true" />
									        				
						        			<pr:commandLink 
						        				styleClass="btn btn-info" 
						        				value="Pesquisar"
						        				action="#{notificacaoView.pesquisarNotificacaoPorFiltro()}" 
						        				update="notificacaoTable"
						        				process="@this,textoPesquisa" />
				        					
				        					<hr />
				        				</div>
						        		
					        		</div>
					        		
					        		<div class="no-padding table-responsive" style="margin-top: 20px;">
						        		<pr:dataTable 
											emptyMessage="Nenhum resultado encontrado com os filtros fornecidos."
											id="notificacaoTable" 
											var="notificacao" 
											rows="10"
											rowIndexVar="notificacaoRow" 
											value="#{notificacaoView.notificacaoDataModel}"
											tableStyleClass="table table-striped card-table"
											style="border: 0px solid black !important;"
											tableStyle="border: 0px solid black !important;"
											paginator="true"
											lazy="true"
											paginatorAlwaysVisible="true"
											paginatorPosition="bottom"
											paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
							               	rowsPerPageTemplate="5,10,15,20,50,100">
											<pr:column headerText="#" style="text-align: left; font-size: 85%; width: 10px;">
												<h:outputText value="#{notificacaoRow + 1}" />
											</pr:column>
											<pr:column headerText="Data Cadastro" style="text-align: left; font-size: 85%; width: 120px;">
												<h:outputText value="#{notificacao.dataNotificacao}">
													<f:convertDateTime pattern="dd/MM/yyyy 'às' HH:mm:ss"/>
												</h:outputText>
											</pr:column>
											<pr:column headerText="Data Envio" style="text-align: left; font-size: 85%; width: 120px;">
												<h:outputText value="#{notificacao.dataEnvio}">
													<f:convertDateTime pattern="dd/MM/yyyy 'às' HH:mm:ss"/>
												</h:outputText>
											</pr:column>
											<pr:column headerText="Texto" style="text-align: left; font-size: 85%; width: 300px;">
												<h:outputText value="#{notificacao.texto}" />
											</pr:column>
											<pr:column exportable="false" headerText="Ações" styleClass="tools" style="text-align: left; font-size: 90%; width: 120px;">														
												<pr:commandLink 
													action="#{notificacaoView.carregarNotificacao(notificacao)}" 
													style="color: #70B9B0;" 
													title="Excluir"
													oncomplete="exibirExcluirNotificacao();" 
													update="panelModalDetalheExclusao"
													process="@this">
													<span class="fa fa-times"></span>
												</pr:commandLink>
											</pr:column>
										</pr:dataTable>
				      				</div>
						        	
						        </div>
							</div>
						</div>	
					</div>
				</div>
			</div>
			
			<script>
				function fecharModalNova() {
					$('#modalNova').modal('hide');
					window.scrollTo(0, 0);
				}
				function exibirNova() {
					$('#modalNova').modal('show');
				}
				function esconderLoading() {
					$('#preload').fadeOut(100);
				}
				function exibirExcluirNotificacao() {
					$('#modalDetalheExclusao').modal('show');
				}
				function fecharModalExclusao() {
					$('#modalDetalheExclusao').modal('hide');
					window.scrollTo(0, 0);
				}
			</script>
			
		</ui:define>
		
	</ui:composition>
	
</f:view>